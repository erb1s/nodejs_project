<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Matrix Chat</title>
  <!-- Libs згідно завдання -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/alpinejs" defer></script>

  <!-- Підключення скриптів компонентів -->
  <script src="./login/login.js"></script>
  <script src="./sidebar/sidebar.js"></script>

  <!-- Окремі стилі для кожного компоненту -->
  <link rel="stylesheet" href="./login/login.css">
  <link rel="stylesheet" href="./sidebar/sidebar.css">

  <!-- Базові стилі сторінки (дозволено в index.html) -->
  <style>
    .chat-container { min-height: 80vh; }
    .sidebar { min-width: 250px; }
    .chat-area { flex-grow: 1; }
    .message-input { min-height: 80px; }
  </style>
</head>

<body class="bg-gray-100 flex items-center justify-center p-4">
  <div x-data="chatApp()" class="chat-container bg-white rounded-lg shadow-lg flex w-full max-w-5xl">
    <!-- Контейнер для сайдбару -->
    <div id="sidebar-container"></div>

    <!-- Контейнер для основної області -->
    <div class="chat-area p-4 flex flex-col">
      <!-- Контейнер для логіну -->
      <div id="login-container"></div>
      <!-- Місце під майбутній чат -->
      <div id="chat-area" class="mt-6"></div>
    </div>
  </div>

  <!-- Завантаження компонентів (універсально: Electron або браузер) -->
  <script>
    async function loadPart(relPath, targetId) {
      const hostEl = document.getElementById(targetId);
      try {
        // Якщо є preload API (Electron) — читаємо з диска
        if (window.components?.load) {
          const html = await window.components.load(relPath);
          hostEl.innerHTML = html;
        } else {
          // Інакше — звичайний fetch (браузер / http-сервер)
          const res = await fetch(relPath);
          hostEl.innerHTML = await res.text();
        }
        // Переініціалізуємо вставлений DOM для Alpine
        if (window.Alpine?.initTree) window.Alpine.initTree(hostEl);
      } catch (e) {
        console.error('Component load error:', relPath, e);
        hostEl.innerHTML = `<div class="p-3 bg-red-50 text-red-700 rounded">Failed to load ${relPath}</div>`;
      }
    }

    document.addEventListener('DOMContentLoaded', async () => {
      await loadPart('./login/login.html', 'login-container');
      await loadPart('./sidebar/sidebar.html', 'sidebar-container');
    });

    // Стан і методи (завдання вимагає ці поля та login/createRoom/fetchRoomsWithNames)
    function chatApp() {
      return {
        username: '',
        password: '',
        accessToken: '',
        userId: '',
        roomId: '',
        joinRoomId: '',
        newRoomName: '',
        newRoomId: '',
        rooms: [],
        messages: [],
        newMessage: '',
        inviteUser: '',
        error: '',
        lastSyncToken: '',

        // Методи з компонентів:
        login,              // ./login/login.js
        createRoom,         // ./sidebar/sidebar.js
        fetchRoomsWithNames // ./sidebar/sidebar.js
      };
    }
  </script>
</body>
</html>
